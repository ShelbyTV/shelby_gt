<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: MemcachedVideoProcessingLinkCache
  
    &mdash; Documentation by YARD 0.7.5
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (M)</a> &raquo; 
    
    
    <span class="title">MemcachedVideoProcessingLinkCache</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: MemcachedVideoProcessingLinkCache
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">MemcachedVideoProcessingLinkCache</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/cache/memcached_video_processing_link_cache.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Keeping track of video metadata from embed.ly to reduce the number of calls
we have to make memcached key is an MD5 hash of the URL (although memcached
authors say this isn't necessary)</p>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="EMBEDLY_FIELD-constant" class="">EMBEDLY_FIELD =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>e</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="KEY_PREFIX-constant" class="">KEY_PREFIX =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>e</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#embedly_json-instance_method" title="#embedly_json (instance method)">- (Object) <strong>embedly_json</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute embedly_json.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-class_method" title="create (class method)">+ (Object) <strong>create</strong>(options, memcached) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Store the embed.ly resolution in memcached.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_by_url-class_method" title="find_by_url (class method)">+ (Object) <strong>find_by_url</strong>(url, memcached) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the embed.ly raw json for a URL.</p>
</div></span>
  
</li>

      
    </ul>
  


  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="embedly_json=-instance_method"></span>
      <span id="embedly_json-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="embedly_json-instance_method">
  
    - (<tt>Object</tt>) <strong>embedly_json</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute embedly_json</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cache/memcached_video_processing_link_cache.rb', line 8</span>

<span class='kw'>def</span> <span class='id identifier rubyid_embedly_json'>embedly_json</span>
  <span class='ivar'>@embedly_json</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="create-class_method">
  
    + (<tt>Object</tt>) <strong>create</strong>(options, memcached) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Store the embed.ly resolution in memcached.</p>

<p>--arguments--</p>

<p>options -- REQUIRED:</p>

<pre class="code ruby"><code>:url  -- REQUIRED -- the URL for which we are storing the result of the call to embed.ly
:embedly_json  -- REQUIRED -- the raw json returned by embed.ly (or nil if embed.ly says NO VIDEO via 404)</code></pre>

<p>memcached -- REQUIRED -- should be an instance of a Memcached client.  Use
GT::Arnold::MemcachedManager.get_client</p>


  </div>
</div>
<div class="tags">
  
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cache/memcached_video_processing_link_cache.rb', line 19</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='id identifier rubyid_memcached'>memcached</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>options must include :url as String</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:url</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:url</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>String</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>options must include :embedly_json as String or nil</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:embedly_json</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:embedly_json</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='kw'>nil</span> <span class='kw'>or</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:embedly_json</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span><span class='rparen'>)</span>
  
  <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_get_key_from_url'>get_key_from_url</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:url</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  
  <span class='comment'>#store the embedly json (w/ they key being the md5 hash of the url)
</span>  <span class='comment'>#embedly json may be nil, this is okay, we want to cache that too
</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_memcached'>memcached</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='const'>EMBEDLY_FIELD</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:embedly_json</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
  <span class='kw'>rescue</span> <span class='const'>Memcached</span><span class='op'>::</span><span class='const'>NotStored</span>
    <span class='comment'>#puts 'video cache already contains item'
</span>  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="find_by_url-class_method">
  
    + (<tt>Object</tt>) <strong>find_by_url</strong>(url, memcached) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Get the embed.ly raw json for a URL</p>

<p>--arguments--</p>

<p>url -- REQUIRED -- The URL for which you want the embed.ly json result. 
NOTE: This is the the embed.ly API call, this is the video source url as
seen in the wild. memcached -- REQUIRED -- should be an instance of a
Memcached client.  Use GT::Arnold::MemcachedManager.get_client</p>

<p>--returns-- an instance of MemcachedVideoProcessingLinkCache upon which you
can call embedly_json to get the raw embed.ly json as embed.ly returned it
for this url. nil on cache miss.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cache/memcached_video_processing_link_cache.rb', line 47</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_find_by_url'>find_by_url</span><span class='lparen'>(</span><span class='id identifier rubyid_url'>url</span><span class='comma'>,</span> <span class='id identifier rubyid_memcached'>memcached</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_url'>url</span> <span class='op'>==</span> <span class='kw'>nil</span>
  
  <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_get_key_from_url'>get_key_from_url</span><span class='lparen'>(</span><span class='id identifier rubyid_url'>url</span><span class='rparen'>)</span>
  
  <span class='comment'>#resolved is nil if there's nothing in memcached, the raw embedly json, or empty string if embedly returned nothing
</span>  <span class='kw'>begin</span>
    <span class='id identifier rubyid_resolved'>resolved</span> <span class='op'>=</span> <span class='id identifier rubyid_memcached'>memcached</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span> <span class='id identifier rubyid_key'>key</span> 
  <span class='kw'>rescue</span> <span class='const'>Memcached</span><span class='op'>::</span><span class='const'>NotFound</span>
    <span class='id identifier rubyid_resolved'>resolved</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='comment'>#puts 'video cache miss'
</span>  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_resolved'>resolved</span> <span class='kw'>and</span> <span class='id identifier rubyid_resolved'>resolved</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Hash</span>

    <span class='comment'>#Building an object to match the old sematics
</span>    <span class='id identifier rubyid_obj'>obj</span> <span class='op'>=</span> <span class='const'>MemcachedVideoProcessingLinkCache</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_resolved'>resolved</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_obj'>obj</span><span class='period'>.</span><span class='id identifier rubyid_embedly_json'>embedly_json</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_resolved'>resolved</span><span class='lbracket'>[</span><span class='const'>EMBEDLY_FIELD</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>String</span>
      <span class='id identifier rubyid_obj'>obj</span><span class='period'>.</span><span class='id identifier rubyid_embedly_json'>embedly_json</span> <span class='op'>=</span> <span class='id identifier rubyid_resolved'>resolved</span><span class='lbracket'>[</span><span class='const'>EMBEDLY_FIELD</span><span class='rbracket'>]</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_resolved'>resolved</span><span class='lbracket'>[</span><span class='const'>EMBEDLY_FIELD</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Hash</span>
      <span class='comment'>#be robust to bad stuff in cache
</span>      <span class='id identifier rubyid_obj'>obj</span><span class='period'>.</span><span class='id identifier rubyid_embedly_json'>embedly_json</span> <span class='op'>=</span> <span class='id identifier rubyid_resolved'>resolved</span><span class='lbracket'>[</span><span class='const'>EMBEDLY_FIELD</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
    <span class='kw'>else</span>
      <span class='kw'>return</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_obj'>obj</span>
  <span class='kw'>else</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Tue Jun  5 08:52:27 2012 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.5 (ruby-1.9.3).
</div>

  </body>
</html>
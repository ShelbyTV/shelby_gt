<%= javascript_tag do -%>
  if(<%= !@no_redirect %> && window.opener && window.close){
    // We were opened as a popup, redirect the opener and close ourselves
    window.opener.location.href = "<%= @opener_location %>";
    try {
      window.opener.location.reload(true);
    }
    catch(e){}
    window.close();
  }
  else {
    // Just redirect ourselves (this happens with cohort links)
    window.location = "<%= @opener_location %>";
  }
<% end -%>